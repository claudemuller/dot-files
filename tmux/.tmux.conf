set -g default-command "${SHELL} -l"

# List of plugins
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "ofirgall/tmux-window-name"
set -g @plugin "omerxx/tmux-floax"
set -g @plugin "tmux-plugins/tmux-yank"

set-option -g default-shell /bin/zsh

# Fix delay in editors
set -sg escape-time 0

#set -g default-terminal "tmux-256color"
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -sa terminal-features ",xterm-256color:RGB"

set -g status-interval 5
set -g status-bg "#1a1c1e"
set -g status-fg "#80868B"

# Window title with separators
setw -g window-status-format "#I:#W (#P)
setw -g window-status-current-format "#I:#W (#P)"
setw -g window-status-separator " . "

set -g status-left "[#H] "
set -g status-right "#(kubectl config current-context 2>/dev/null) | #S | %Y-%m-%d %H:%M"
set -g status-left-length 20
set -g status-right-length 80

set -gq allow-passthrough on
set -g base-index 1
set -g renumber-windows on
set-option -g mouse on
setw -g mode-keys vi

set-option -s set-clipboard on
# bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
#bind-key -T copy-mode-vi y send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -se c -i"
#unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -se c -i"

# minimise current pane and zoom into "other"
bind-key -T prefix Enter run-shell '
  if [ "$(tmux display-message -p "#{window_zoomed_flag}")" = "1" ]; then
    tmux resize-pane -Z \; last-pane
  else
    tmux last-pane \; resize-pane -Z
  fi
'
bind-key -T prefix C-M run-shell '
  if [ "$(tmux display-message -p "#{window_zoomed_flag}")" = "1" ]; then
    tmux resize-pane -Z \; last-pane
  else
    tmux last-pane \; resize-pane -Z
  fi
'

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Mac copy and paste
#bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
#bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.tmux/plugins/tpm/tpm"

# open a "console" split below (has to be here to ovrride powerkit)
unbind-key -T prefix C-d
bind-key -T prefix C-d split-window -v \; select-pane -U \; resize-pane -Z
